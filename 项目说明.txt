项目名：StarStack（星栈）

项目简介：
- 技术栈：Vite + React（前端）、Node.js + Express（后端）、SQLite（数据库）
- 这是一个星空风格的算法测评平台，包含账号系统、题库/OJ、评测与记录展示，以及管理员用户管理功能。
- 支持多语言在线编程、实时判题、代码提交记录查看等完整的 OJ 功能。

核心功能：
1) 账号系统
   - 注册：ID（用户名）长度要求 >=6 字符
   - 登录：使用 ID + 密码
   - 修改资料：支持修改用户名（唯一性校验） + 密码
   - 管理员权限：可提升/降级用户权限

2) OJ 评测系统（核心）
   - 题库列表：支持搜索/标签/难度筛选
   - 题目详情：显示题号（p1000 格式）、标题/难度/标签/题面
   - 在线 IDE（Monaco Editor）：支持代码编辑、语法高亮、自动补全、主题切换
   - 运行样例：点击样例可直接运行并查看输出/对比期望输出
   - 自定义测试：支持自定义输入 + 期望输出进行测试
   - 提交评测：提交代码后跳转到独立评测页面，显示评测进度和结果
   - 评测结果展示：火箭发射动画、烟花效果（带重力）、大字显示 ACCEPTED/WRONG
   - 防重复评测：每次提交生成唯一 ID，刷新页面不会重复评测

3) 后台管理（仅管理员）
   - 用户管理：创建/删除/提升管理员/降级/重置密码/封禁/解封

核心文件说明：
- src/App.tsx：前端核心逻辑（路由、页面、IDE、评测、个人主页、排行榜）
- src/App.css：全站样式（星空背景、OJ 界面、IDE 样式、动画效果、统计面板）
- server/index.js：API 主入口
- server/judge.js：判题与运行逻辑（C++/Java/Python，含预热机制）
- server/db.js：数据库初始化（10个表）
- server/stats.js：统计工具函数（成就系统、排行榜、热力图）

路由结构：
- /                       首页
- /auth                   登录/注册（弹窗形式）
- /games                  游戏占位页
- /account                账号中心（个人主页，含统计、热力图、成就）
- /admin                  后台管理（仅管理员）
- /leaderboard            排行榜
- /oj                     题库首页（重定向到列表）
- /oj/list                题库列表（按题号从小到大排序）
- /oj/p:id                题目详情页（例如 /oj/p1001）
- /oj/judge               评测页（新提交时使用）
- /oj/judge/:id           评测结果页（查看已有提交）
- /oj/records/:id         某题提交记录
- /oj/submissions         我的提交

主要 API 端点：
账号
- POST /api/register
- POST /api/login
- POST /api/logout
- GET  /api/me
- PATCH /api/me/name
- POST /api/me/password

OJ
- GET  /api/oj/problems                题库列表（按题号升序）
- GET  /api/oj/problems/:id            题目详情
- POST /api/oj/submissions             提交判题
- GET  /api/oj/submissions             当前用户提交
- GET  /api/oj/submissions/:id         单条提交详情
- GET  /api/oj/submissions/all         某题所有提交（含过滤）
- GET  /api/oj/submissions/latest      当前用户该题最近提交
- POST /api/oj/run-sample              运行样例
- POST /api/oj/run-custom              自定义测试

用户统计
- GET  /api/user/profile/:userId       用户完整资料和统计
- GET  /api/user/heatmap/:userId       做题热力图（365天）
- GET  /api/user/achievements/:userId  用户成就列表
- GET  /api/leaderboard                全站排行榜

做题计划
- GET    /api/problem-plan             获取当前用户做题计划
- POST   /api/problem-plan             添加题目到计划
- DELETE /api/problem-plan/:id         从计划中移除题目
- PUT    /api/problem-plan/:id/complete 标记题目完成状态

管理
- GET  /api/admin/users
- POST /api/admin/users
- POST /api/admin/users/:id/promote
- POST /api/admin/users/:id/demote
- POST /api/admin/users/:id/reset-password
- POST /api/admin/users/:id/ban
- DELETE /api/admin/users/:id

判题系统特性：
- 支持语言：C++17、Python3、Java17
- 编译/运行缓存机制
- 测试点结果以 JSON 格式存储在 results_json 字段
- 支持时间限制、内存限制
- Windows 下需要安装编译器（WinLibs/MSYS2/JDK/Python）
- 预热机制：编译后先运行一次空输入，消除第一个测试点的进程启动开销

数据库结构：
- SQLite，由 server/db.js 自动初始化
- 主要表：
  * users - 用户信息
  * sessions - 登录会话
  * problems - 题目信息
  * testcases - 测试用例
  * submissions - 提交记录（results_json 字段存储详细测试结果）
  * user_stats - 用户统计数据
  * daily_activity - 每日活动记录
  * user_achievements - 用户成就
  * solved_problems - 已解决题目记录
  * problem_plan - 做题计划

本地运行方法：
前端：
- npm install
- npm run dev
后端：
- node server/index.js
默认端口：前端 5173，后端 5174

已完成功能：
- 完整的账号系统（注册/登录/修改资料）
- 题库列表、搜索、筛选（标签/难度）
- 题目详情页，支持 LaTeX 公式渲染
- 在线 IDE（Monaco Editor，已禁用粘性滚动）
- 运行样例/自定义测试
- 提交评测，支持 C++/Python/Java
- 评测结果展示（火箭动画、烟花效果、大字显示）
- 提交记录查看（个人/全站）
- 后台用户管理
- 个人主页增强（统计面板、热力图、成就系统、排行榜）
- 做题计划功能（右侧固定面板）
- 题库按题号排序（从小到大）

最近完成的优化（2026-02-02）：
1. 判题时间优化
   - 修复第一个测试点时间过长的问题
   - 在 judgeSubmission 和 runSample 函数中添加预热机制
   - 编译完成后先运行一次空输入，丢弃这次的时间
   - 消除进程启动、缓存加载等开销，使时间统计更准确
   - 修改文件：server/judge.js

2. 评测系统路由优化
   - 每次提交后自动跳转到独立路由 /oj/judge/:submissionId
   - 使用 replace: true 替换历史记录，防止返回时重复提交
   - 刷新页面时直接加载已有提交记录，不会重复评测
   - 优化了 useEffect 依赖，先检查 submissionId 再检查新提交
   - 修改文件：src/App.tsx (OjJudgePage 组件)

3. 评测结果展示优化
   - 成功时显示绚丽的烟花效果（带重力下落）
   - 烟花粒子先向外爆炸，然后受重力影响向下坠落 150px
   - 成功时显示大大的绿色 ACCEPTED 文字（48px，发光效果）
   - 失败时显示大大的红色 WRONG 文字（48px，发光效果）
   - 文字带有弹出动画和阴影效果
   - 修改文件：src/App.tsx (结果文字显示)、src/App.css (动画和样式)

4. 个人主页增强功能（2026-02-02）
   - 统计面板：总提交数、AC数、尝试题数、AC率、连续打卡天数
   - 做题热力图：GitHub风格的365天活动热力图
   - 难度进度：各难度题目完成情况可视化（动态读取数据库难度）
   - 成就系统：11种成就徽章（首次AC、连续打卡、题目里程碑等）
   - 排行榜：按解题数、提交数、AC率排序
   - 做题计划：右侧固定面板，可添加题目到计划并跟踪完成状态
   - 新增数据库表：user_stats、daily_activity、user_achievements、solved_problems、problem_plan
   - 新增文件：server/stats.js（统计工具函数）
   - 修改文件：server/db.js、server/index.js、src/App.tsx、src/App.css

5. Monaco Editor 优化（2026-02-02）
   - 禁用 Sticky Scroll（粘性滚动）功能
   - 编辑器顶部不再显示当前函数/循环头部
   - 修改文件：src/App.tsx（Editor 组件配置）

6. 题库排序优化（2026-02-02）
   - 题目按题号从小到大排序（p1001, p1002, p1003...）
   - 修改文件：server/index.js（ORDER BY id ASC）

已知问题和待完成功能：
已修复
- ✅ 第一个测试点时间过长问题（已通过预热机制解决）
- ✅ 刷新页面重复评测问题（已通过路由优化解决）
- ✅ 评测结果展示单调问题（已添加烟花和大字效果）

待完成
- 题目管理 API（/api/admin/problems*、/api/admin/testcases*）
- 内置示例题目 p1000~p1002（目前需要手动添加）
- 完善后台管理的 problems/testcases/submissions 管理界面

最新完成的功能（2026-02-05）：
1. 用户菜单优化
   - 顶栏用户菜单增加300ms延迟关闭，防止误操作
   - 点击头像可直接跳转到个人中心
   - 修改文件：src/App.tsx（UserMenu组件）

2. IDE界面重构
   - 重新设计为洛谷风格，完全透明背景展现星空
   - 简化头部布局：语言选择器 + 提交按钮
   - 移除标题和副标题，界面更简洁
   - Monaco Editor完全透明，代码浮在星空中
   - 修改文件：src/App.tsx、src/App.css

3. 题目详情页优化
   - 统一所有题目信息为一体化布局（参考洛谷）
   - 顺序：标题 → 描述 → 输入格式 → 输出格式 → 样例 → 数据范围
   - 使用自然间距分隔，无分隔线
   - 修改文件：src/App.tsx、src/App.css

4. 排行榜筛选按钮升级
   - 现代化设计，带玻璃态效果
   - 图标使用灰度滤镜，激活时变彩色
   - 渐变背景和发光效果
   - 修改文件：src/App.css

5. 等级分系统实现
   - 移除提交数和通过率排序
   - 新增等级分机制，用户默认0分
   - 难度分值规则：
     * 入门: 0.05分/题（2题=0.1分）
     * 普及-: 0.1分/题
     * 普及: 0.2分/题
     * 提高-: 0.3分/题
     * 提高: 0.4分/题
     * 省选: 0.5分/题
     * noi: 0.6分/题
   - 在线统计：用户首次通过题目时实时增加等级分
   - 登录时离线统计：重新计算用户总等级分，确保数据准确
   - 排行榜按等级分排序
   - 数据库新增：users表添加rating字段
   - 修改文件：server/db.js、server/index.js、server/stats.js、src/App.tsx

6. 难度颜色系统优化
   - 个人中心题目完成情况按难度排序（入门→普及-→普及→提高-→提高→省选→noi）
   - 更新为自定义难度颜色方案：
     * 入门: 红色 #fe4c61
     * 普及-: 深黄色 #f39c11
     * 普及: 黄色 #ffc116
     * 提高-/提高: 绿色 #52c41a
     * 省选: 蓝色 #3498db
     * noi: 深灰色 #555555
   - 应用范围：题库列表、题目详情页、个人中心（标签+进度条）
   - 修改文件：src/App.tsx、src/App.css

默认管理员：
- 账号：admin
- 密码：admin123
- 首次运行时自动创建（如果不存在）
- 建议首次登录后立即修改密码
